name: ReconMaster Daily Recon

on:
  workflow_dispatch:
    inputs:
      domain:
        description: "Target domain"
        required: true
  schedule:
    - cron: "0 3 * * *"   # Daily at 03:00 UTC

jobs:
  recon:
    runs-on: ubuntu-latest
    timeout-minutes: 180

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install system dependencies
        run: |
          sudo apt update
          sudo apt install -y nmap jq Chromium

      - name: Install Recon Tools
        run: |
          go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install github.com/projectdiscovery/dnsx/cmd/dnsx@latest
          go install github.com/projectdiscovery/katana/cmd/katana@latest
          go install github.com/ffuf/ffuf@latest
          go install github.com/sensepost/gowitness@latest
          go install github.com/tomnomnom/assetfinder@latest
          go install github.com/owasp-amass/amass/v4/...@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: Install Python deps
        run: pip install -r requirements.txt

      - name: Run ReconMaster
        env:
          TARGET_DOMAIN: ${{ github.event.inputs.domain || secrets.RECON_DOMAIN }}
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
        run: |
          python3 reconmaster.py \
            -d "$TARGET_DOMAIN" \
            --passive-only \
            --resume \
            --daily \
            --webhook "$WEBHOOK_URL" \
            --i-understand-this-requires-authorization

      - name: Upload Recon Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: recon-results
          path: recon_results/
